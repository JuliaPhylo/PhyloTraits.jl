<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Continuous trait simulation · PhyloTraits.jl</title><meta name="title" content="Continuous trait simulation · PhyloTraits.jl"/><meta property="og:title" content="Continuous trait simulation · PhyloTraits.jl"/><meta property="twitter:title" content="Continuous trait simulation · PhyloTraits.jl"/><meta name="description" content="Documentation for PhyloTraits.jl."/><meta property="og:description" content="Documentation for PhyloTraits.jl."/><meta property="twitter:description" content="Documentation for PhyloTraits.jl."/><meta property="og:url" content="https://JuliaPhylo.github.io/PhyloTraits.jl/man/simulate_continuous/"/><meta property="twitter:url" content="https://JuliaPhylo.github.io/PhyloTraits.jl/man/simulate_continuous/"/><link rel="canonical" href="https://JuliaPhylo.github.io/PhyloTraits.jl/man/simulate_continuous/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.png" alt="PhyloTraits.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.png" alt="PhyloTraits.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PhyloTraits.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../phyloregression/">Continuous trait analysis</a></li><li class="is-active"><a class="tocitem" href>Continuous trait simulation</a><ul class="internal"><li><a class="tocitem" href="#Brownian-motion"><span>Brownian motion</span></a></li><li><a class="tocitem" href="#shifted-Brownian-motion"><span>shifted Brownian motion</span></a></li></ul></li><li><a class="tocitem" href="../fitDiscrete/">Discrete trait analysis</a></li><li><a class="tocitem" href="../fitdiscreteDNA/">DNA evolutionary models</a></li><li><a class="tocitem" href="../simulate_discrete/">Discrete trait simulation</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../lib/public/">public</a></li><li><a class="tocitem" href="../../lib/internal/">internals</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Continuous trait simulation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Continuous trait simulation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaPhylo/PhyloTraits.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaPhylo/PhyloTraits.jl/blob/main/docs/src/man/simulate_continuous.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Continuous-trait-simulation"><a class="docs-heading-anchor" href="#Continuous-trait-simulation">Continuous trait simulation</a><a id="Continuous-trait-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-trait-simulation" title="Permalink"></a></h1><p>We show here how PhyloPlots can be used to simulate data under a Brownian motion (BM) process. We use the same network as in the previous section. The data used in the previous section was actually obtained using this simulation (followed by some rounding).</p><h2 id="Brownian-motion"><a class="docs-heading-anchor" href="#Brownian-motion">Brownian motion</a><a id="Brownian-motion-1"></a><a class="docs-heading-anchor-permalink" href="#Brownian-motion" title="Permalink"></a></h2><p>We simulate three traits on the network: two independent traits that serve as predictors, and one &quot;dependent&quot; trait that is affected by the first 2. We start by choosing the parameters of the BM (ancestral mean and variance), by creating objects of class <a href="../../lib/public/#PhyloTraits.ParamsBM"><code>ParamsBM</code></a><code>&lt;:ParamsProcess</code>.</p><pre><code class="language-julia hljs">params_trait1 = ParamsBM( 2, 0.5) # BM with mean  2 and variance 0.5
params_trait2 = ParamsBM(-2, 1)   # BM with mean -2 and variance 1.0</code></pre><p>We then simulate the traits to serve as predictors according to these parameters, using function <a href="../../lib/public/#Base.rand"><code>rand</code></a>. For reproducibility, we use a stable random number generator (RNG), but the default random generator is better (and more efficient). To use the default RNG, simply remove <code>rng</code> in the code below.</p><pre><code class="language-julia hljs">using StableRNGs; rng = StableRNG(18480224); # stable RNG for reproducibility
sim1 = rand(rng, truenet, params_trait1)  # simulate a BM on truenet
sim2 = rand(rng, truenet, params_trait2)</code></pre><p>This creates objects of class <a href="../../lib/public/#PhyloTraits.TraitSimulation"><code>TraitSimulation</code></a>, from which we can extract the data at the tips, thanks to the method <a href="../../lib/internal/#Base.getindex"><code>getindex(::TraitSimulation, ::Symbol)</code></a>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; trait1 = sim1[:tips] # trait 1 at the tips (data)</code><code class="nohighlight hljs ansi" style="display:block;">6-element Vector{Float64}:
  2.668361022724296
  3.6959860408943888
  4.54050665744728
  4.846082872531411
  2.2675521766599505
 -0.33145290146825923</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; trait2 = sim2[:tips]</code><code class="nohighlight hljs ansi" style="display:block;">6-element Vector{Float64}:
 -3.0082260758711197
 -4.146087430962012
 -2.3380570183619724
  0.6548004043004525
 -3.339449883560931
 -4.566488146403815</code></pre><p>This extractor creates an <code>Array</code> with one column, and as many lines as the number of tips there are in the phylogeny.  It is sorted in the same order as the tips of the phylogeny used to simulate it.   If needed, we could also extract the simulated values at the internal nodes in the network:</p><pre><code class="language-julia hljs">sim1[:internalnodes]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">7-element Vector{Float64}:
 3.3116834769644856
 4.438346935101672
 3.922184789985015
 3.34200857698516
 2.563756870695104
 1.3151130340020023
 2.0</code></pre><p>These values (rounded to 3 digits) are those used in section <a href="../phyloregression/#Ancestral-state-reconstruction">Ancestral state reconstruction</a>, when we compared the ancestral state reconstruction (or &quot;predictions&quot;) of trait 1 (stored in <code>ancTrait1</code>) to the true simulated value.</p><p>Finally, we generate the last trait correlated with trait 1 (but not trait 2), with phylogenetic noise.</p><pre><code class="language-julia hljs">noise = rand(StableRNG(18700904), truenet, ParamsBM(0, 0.1)) # phylogenetic residuals
trait3 = 10 .+ 2 * trait1 .+ noise[:tips] # trait to study. independent of trait2</code></pre><p>For a simulation study, we would assume that we measured the three traits above, and then we would like to apply analysis methods to these data, e.g. to see how they infer the impact of traits 1 and 2 on trait 3. To do that, we may need to create a data frame containing all 3 traits, as shown below:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using DataFrames</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; dat = DataFrame(trait1 = trait1, trait2 = trait2, trait3 = trait3,
                       tipnames = tiplabels(sim1))</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr1">6×4 DataFrame</span>
<span class="sgr1"> Row </span>│<span class="sgr1"> trait1     trait2    trait3   tipnames </span>
     │<span class="sgr90"> Float64    Float64   Float64  String   </span>
─────┼────────────────────────────────────────
   1 │  2.66836   -3.00823  15.4238  D
   2 │  3.69599   -4.14609  17.3332  C
   3 │  4.54051   -2.33806  18.1147  A
   4 │  4.84608    0.6548   18.8098  B
   5 │  2.26755   -3.33945  13.337   E
   6 │ -0.331453  -4.56649  10.0124  O</code></pre><p>These data were rounded to 3 digits and used in the previous section on <a href="../phyloregression/#Phylogenetic-regression">Phylogenetic regression</a>.</p><h2 id="shifted-Brownian-motion"><a class="docs-heading-anchor" href="#shifted-Brownian-motion">shifted Brownian motion</a><a id="shifted-Brownian-motion-1"></a><a class="docs-heading-anchor-permalink" href="#shifted-Brownian-motion" title="Permalink"></a></h2><p>In a shifted BM, the trait evolves as a BM on the network most of the time, but undergo sudden <em>shifts</em> on some of the branches. The positions and values of the shifts can be stored in a <a href="../../lib/public/#PhyloTraits.ShiftNet"><code>ShiftNet</code></a> object. The position of the shifts can be given using vector of edges. To see this, let&#39;s first plot the network with its associated edges and node numbers.</p><pre><code class="language-julia hljs">plot(truenet, useedgelength=true, showedgenumber=true);</code></pre><p><img src="../../assets/figures/truenet_with_numbers.svg" alt="truenet_with_numbers"/></p><p>For identifiability reasons, shifts are only allowed on tree (not hybrid) edges. Here, a shift on either hybrid edge 9 or 7 would have the same effect as a shift on edge 6: by shifting traits of species A and B.</p><p>Let&#39;s say that we want to add a shift with value 5.0 on the branch directly following the hybridization event, in order to model transgressive evolution. We can see on the plot above that this branch is number 6, so we define the following object:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; edge_afterhyb = truenet.edge[6] # the 6th edge has number 6</code><code class="nohighlight hljs ansi" style="display:block;">PhyloNetworks.EdgeT{PhyloNetworks.Node}:
 number:6
 length:2.2
 attached to 2 node(s) (parent first): 5 -7</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shift = ShiftNet(truenet.edge[6], 5.0,  truenet)</code><code class="nohighlight hljs ansi" style="display:block;">ShiftNet:
──────────────────────────
  Edge Number  Shift Value
──────────────────────────
          6.0          5.0
──────────────────────────</code></pre><p>Note that the edge numbers and values of a <code>ShiftNet</code> object can be retrieved thanks to functions <a href="../../lib/public/#PhyloTraits.getshiftedgenumber-Tuple{ShiftNet}"><code>getshiftedgenumber</code></a> and <a href="../../lib/public/#PhyloTraits.getshiftvalue-Tuple{ShiftNet}"><code>getshiftvalue</code></a>. The constructor can take a single edge and associated value, like here, or two vectors of edges and matching values.</p><p>Because we often need to put shifts only on edges right after hybrids, there is a special function <a href="../../lib/public/#PhyloTraits.shiftathybrids-Tuple{VecOrMat{T} where T&lt;:Real, PhyloNetworks.HybridNetwork}"><code>shiftathybrids</code></a> to do that, so that we do not have to find out their edges number. Here, the <code>shift</code> object could hence have been defined as:</p><pre><code class="language-julia hljs">shift = shiftathybrids(5.0,  truenet)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ShiftNet:
──────────────────────────
  Edge Number  Shift Value
──────────────────────────
          6.0          5.0
──────────────────────────
</code></pre><p>The parameters for the simulation are then defined as above, just adding our <code>ShiftNet</code> object as a parameter. Again, we use a custom stable random number generator to make our example reproducible, but we recommend <em>against</em> this random number generator forf simulation studies (just remove the argument <code>rng</code>).</p><pre><code class="language-julia hljs">params_sh = ParamsBM(2, 0.5, shift) # BM with mean 2, variance 0.5, and shifts.</code></pre><p>The traits are simulated using the same function <a href="../../lib/public/#Base.rand"><code>rand</code></a>, and extracted at the tips as before.</p><pre><code class="language-julia hljs">rng = StableRNG(18700904)
sim_sh = rand(rng, truenet, params_sh) # simulate a shifted BM on truenet
trait_sh = sim_sh[:tips]          # trait at the tips (data)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6-element Vector{Float64}:
  2.1947024460829594
  1.8685916258969295
  4.839327306337874
  5.027005765795342
 -0.6790231457083361
  3.509974852157824</code></pre><pre><code class="language-julia hljs">tiplabels(sim_sh)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6-element Vector{String}:
 &quot;D&quot;
 &quot;C&quot;
 &quot;A&quot;
 &quot;B&quot;
 &quot;E&quot;
 &quot;O&quot;</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../phyloregression/">« Continuous trait analysis</a><a class="docs-footer-nextpage" href="../fitDiscrete/">Discrete trait analysis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 9 January 2025 22:00">Thursday 9 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
